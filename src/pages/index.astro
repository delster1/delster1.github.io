---
import TerminalLayout from "../layouts/TerminalLayout.astro";
import { XMLParser } from "fast-xml-parser";
import figlet from "figlet";
import { marked } from "marked";

const banner = figlet.textSync("Dellie Wright", {
  font: "ANSI Shadow", // try: "Standard", "Slant", "Big", "ANSI Shadow"
  horizontalLayout: "default",
  verticalLayout: "default",
});

let quote = "Failed to load quote.";
try {
    const response = await fetch('https://minipc.d3llie.tech/quote');
    if (response.ok) {
        quote = await response.json();
    }
} catch (error) {
    console.error('Error fetching quote:', error);
}

let nowContent = "Failed to load now content.";
try {
    const response = await fetch('https://minipc.d3llie.tech/now');
    if (response.ok) {
        let markdown = await response.text();
        // Remove surrounding quotes if it was returned as a JSON string
        markdown = markdown.trim();
        if (markdown.startsWith('"') && markdown.endsWith('"')) {
            markdown = markdown.slice(1, -1);
        }
        // Handle escaped newlines
        markdown = markdown.replace(/\\n/g, '\n');
        nowContent = await marked.parse(markdown);
    }
} catch (error) {
    console.error('Error fetching now content:', error);
}

let books = [];
try {
    const response = await fetch('https://www.goodreads.com/review/list_rss/134911869?shelf=currently-reading');
    if (response.ok) {
        const xmlData = await response.text();
        const parser = new XMLParser();
        const jsonObj = parser.parse(xmlData);
        const items = jsonObj.rss.channel.item;
        if (items) {
            books = Array.isArray(items) ? items : [items];
        }
    }
} catch (error) {
    console.error('Error fetching books:', error);
}
---

<TerminalLayout title="d3llie terminal">
    <div class="text-green-400">
        <span class="text-yellow-300">d3llie@website</span>
        <span class="text-blue-400"> ~ </span>
        <span>$</span>
        &nbsp;./website-tui
    </div>
    <div box-="round">
<div box-="round" title="header" class="flex justify-center items-center" style="--box-bg: var(--bg1)">
  <pre class="banner">{banner}</pre>
</div>
<style>
  .banner {
    font-family: "Comic Mono";
    font-size: 18px;          /* tune this */
    line-height: 1.0;         /* key for ‚ÄúNeovim‚Äù tightness */
    letter-spacing: -0.02em;  /* subtle tighten */
    padding: 18px 22px;
    margin: 0;
    white-space: pre;
    color: var(--terminal-text);
    background: var(--bg1);
    border-radius: 12px;
  }
</style>
    <div class="flex justify-center items-center" id="about-btn">
        <div box-="round" shear-="top" class="w-[40%]" style="--box-bg: var(--bg1)" >
            <div class="header">
                 <span is-="badge" variant-="yellow">About Me</span>
            </div>
            <div class="pl-3">
            <h3 class="text-xl text-yellow-400"> ## Hey üëã I'm Dellie ‚Äî </h3>
                CS student, nerd, and HackKU Director.<br />
                Welcome to my personal terminal-style website powered by Astro + Tailwind.
            </div>

            <div box-="round" shear-="top" class="pl-3 hidden-about hidden" style="--box-bg: var(--bg1)">
                <div class="header">
                    <span is-="badge" variant-="blue">quote</span>
                </div>
                {quote}
            </div>
            <div box-="round" shear-="top" class="mt-4 hidden-about hidden" style="--box-bg: var(--bg1)">
                <div class="header">
                    <span is-="badge" variant-="blue">currently reading</span>
                </div>
                {books.length > 0 ? (
                    <ul class="list-none p-0 m-0">
                        {books.map((book) => (
                            <li class="mt-2 flex items-start gap-4">
                                {book.book_small_image_url && (
                                    <img src={book.book_small_image_url} alt={book.title} class="w-12 h-auto border border-gray-700" />
                                )}
                                <div>
                                    <a href={book.link} target="_blank" rel="noopener noreferrer" class="text-blue-400 hover:text-blue-300 transition-colors">
                                        {book.title}
                                    </a>
                                    <div class="text-sm">
                                        <span class="text-gray-400">by </span>
                                        <span class="text-yellow-200">{book.author_name}</span>
                                    </div>
                                </div>
                            </li>
                        ))}
                    </ul>
                ) : (
                    <div class="text-gray-500">No books found or failed to load.</div>
                )}
            </div>
        </div>
        <div box-="round" shear-="top" class="w-[60%]" style="--box-bg: var(--bg1)" >
            <div class="header">
                 <span is-="badge" variant-="yellow">Now</span>
            </div>
            <div class="p-3 now-content" set:html={nowContent} />
        </div>
    </div>
    <script>
        const btn = document.getElementById('about-btn');
        const btnText = btn?.querySelector('.mt-2');
        const hiddenLinks = document.querySelectorAll('.hidden-about');
        
        btn?.addEventListener('click', () => {
            const isExpanded = !hiddenLinks[0].classList.contains('hidden');
            
            hiddenLinks.forEach(link => {
                link.classList.toggle('hidden');
            });

        });
    </script>
    <br />
    <div class="flex justify-center items-center w-[100%]">
        <div box-="round" shear-="top" id="" class="w-[90%]" style="--box-bg: var(--bg1)">
            <div class="header">
                 <span is-="badge" variant-="yellow">My Links</span>
            </div>
            <div class="mt-3 grid grid-cols-1 gap-6 sm:grid-cols-3" id="links-grid">
              <a href="https://github.com/delster1" box-="round" shear-="top" class="p-3 text-center block hover:no-underline" style="--box-bg: var(--bg1)">
                  <br>
                  github
              </a>

              <a href="https://www.linkedin.com/in/delroy-wright-440b35210/" box-="round" shear-="top" class="p-3 block text-center hover:no-underline" style="--box-bg: var(--bg1)">
                <div class="mt-2">
                    <br>
                    linkedin
                  <br>
                </div>
              </a>

              <div box-="round" shear-="top" id="see-more-btn" class="p-3 text-center cursor-pointer block hover:no-underline" style="--box-bg: var(--bg1)">
                  <br>
                <div class="mt-2">
                    see more...
                </div>
              </div>

              <!-- Hidden initially -->
              <a href="/blog" class="hidden-link hidden p-3 text-center block hover:no-underline" box-="round" shear-="top" style="--box-bg: var(--bg1)">
                <br>blog
              </a>
              <a href="#" class="hidden-link hidden p-3 text-center block hover:no-underline" box-="round" shear-="top" style="--box-bg: var(--bg1)">
                <br>projects
              </a>
              <a href="#" class="hidden-link hidden p-3 text-center block hover:no-underline" box-="round" shear-="top" style="--box-bg: var(--bg1)">
                <br>resume
              </a>
              <a href="#" class="hidden-link hidden p-3 text-center block hover:no-underline" box-="round" shear-="top" style="--box-bg: var(--bg1)">
                <br>contact
              </a>
              <a href="#" class="hidden-link hidden p-3 text-center block hover:no-underline" box-="round" shear-="top" style="--box-bg: var(--bg1)">
                <br>extra 1
              </a>
              <a href="#" class="hidden-link hidden p-3 text-center block hover:no-underline" box-="round" shear-="top" style="--box-bg: var(--bg1)">
                <br>extra 2
              </a>
            </div>
        </div>
    </div>


    <script>
        const btn = document.getElementById('see-more-btn');
        const btnText = btn?.querySelector('.mt-2');
        const hiddenLinks = document.querySelectorAll('.hidden-link');
        
        btn?.addEventListener('click', () => {
            const isExpanded = !hiddenLinks[0].classList.contains('hidden');
            
            hiddenLinks.forEach(link => {
                link.classList.toggle('hidden');
            });

            if (btnText) {
                btnText.textContent = isExpanded ? 'see more...' : 'hide';
            }
        });
    </script>

    <div class="statusline">
      <div class="status-left">
        <a class="seg" style="background: var(--bg-red)" href="/about"> about </a>
        <a class="seg" style="background: var(--bg-yellow)" href="/projects"> projects </a>
        <a class="seg" style="background: var(--bg-green)" href="/blog"> blog </a>
      </div>

      <div class="status-right">
        <div class="seg" style="background: var(--bg-red)"> admin: </div>
        <a class="seg" style="background: var(--bg-blue)" href="/login"> login </a>
        <a class="seg" style="background: var(--bg-yellow)" href="/dashboard"> dashboard </a>
      </div>
    </div>


    </div>
</TerminalLayout>
